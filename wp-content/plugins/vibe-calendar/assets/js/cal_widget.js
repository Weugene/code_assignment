!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var a=(0,wp.element.createContext)({events:[],update:function(){}});var r=wp.element,l=(r.createElement,r.useState,r.useEffect,r.Fragment,r.render,r.useRef,wp.data);l.dispatch,l.select;var i=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=[];return e.map(function(e){var n={};if(e.id&&(n.id=e.id),e.post_title&&(n.title=e.hasOwnProperty("postfix")?e.post_title+e.postfix:e.post_title),e.hasOwnProperty("meta")&&Array.isArray(e.meta)&&e.meta.length){var a=e.meta.findIndex(function(e){return"recurring"==e.meta_key});a>-1&&e.meta[a].meta_value?(n.groupId=n.id,"daysOfWeek"==e.meta[a].meta_value.recurring?n.daysOfWeek=e.meta[a].meta_value.daysOfWeek:"everyDay"==e.meta[a].meta_value.recurring&&(n.daysOfWeek=[0,1,2,3,4,5,6]),e.meta.map(function(e){e.meta_key&&e.meta_value&&("start"==e.meta_key?(n.nstart=e.meta_value,n.startTime=new Date(e.meta_value).getHours()+":"+new Date(e.meta_value).getMinutes(),n.startRecur=new Date(e.meta_value)):"end"==e.meta_key?(n.nend=e.meta_value,n.endTime=new Date(e.meta_value).getHours()+":"+new Date(e.meta_value).getMinutes(),n.endRecur=new Date(e.meta_value)):"color"==e.meta_key&&(n.color=e.meta_value))})):e.meta.map(function(e){e.meta_key&&e.meta_value&&("start"==e.meta_key?n.start=e.meta_value:"end"==e.meta_key?n.end=e.meta_value:"color"==e.meta_key&&(n.color=e.meta_value))})}t.push(n)}),t};function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,l=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw l}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var c=wp.element,u=c.useState,m=c.useEffect,d=c.createRef,w=c.useContext,p=(c.useRef,wp.data),v=p.select,f=p.dispatch,g=void 0!==window.vibecal?window.vibecal:window.vibecalwidget,y=function(e){var t=w(a),n=s(u(o(t.events)),2),r=n[0],l=n[1],c=d(null);m(function(){l(o(t.events))},[t.events]);var p=s(u(),2),y=p[0],_=p[1],b=s(u({calendarView:g.view?g.view:"dayGridMonth",slotDuration:"00:15:00",editable:!0,droppable:!0}),2),h=b[0];b[1];return m(function(){if(c){var n={initialView:h.calendarView,themeSystem:"bootstrap",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},editable:h.editable,droppable:h.droppable,locale:t.languageCode,eventDrop:function(e){if(e.event.id){var n=e.event.start.getTime(),a=e.event.end.getTime();r={id:e.event.id,start:n,end:a},fetch("".concat(g.api.url,"/event/drag"),{method:"post",body:JSON.stringify({token:v("vibebp").getToken(),event:r})}).then(function(e){return e.json()}).then(function(e){e.status&&t.update(e.data,"update_drag",r),e.hasOwnProperty("message")&&f("vibebp").addNotification({text:e.message})})}else console.log("some error on drag");var r},eventClick:function(e,n,a){t.update(e.event.id,"show_event_id")},datesSet:function(t){var n=t.view.activeStart.getTime(),a=t.view.activeEnd.getTime();e.updateFilter&&e.updateFilter(n,a)}};!y&&r.length&&(n.events=i(r));var a=new FullCalendar.Calendar(c.current,n);y&&(y.setOption("events",i(r)),y.setOption("locale",t.languageCode),a=y),a.render(),_(a)}},[r,t.languageCode]),wp.element.createElement("div",{className:"vibe_fullcalendar_wrapper"},wp.element.createElement("div",{class:"vibe_fullcalendar"},wp.element.createElement("div",{id:"fullcalendar",ref:c})))};function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,l=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw l}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var E=wp.element,D=E.useState,O=E.useEffect,k=E.Fragment,P=function(e){var t=h(D({}),2),n=t[0],a=t[1];return O(function(){if(e.hasOwnProperty("event")){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach(function(t){b(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e.event),n=t.meta.findIndex(function(e){return"googleevent"==e.meta_key});if(!(n>-1))return"";var r={};r.value=t.meta[n].meta_value,a(r)}},[e.event]),wp.element.createElement(k,null,n&&n.value&&n.value.conferenceData&&n.value.conferenceData.entryPoints&&n.value.conferenceData.entryPoints[0]?wp.element.createElement("span",null,wp.element.createElement("strong",null,window.vibecal.translations.meeting),wp.element.createElement("span",null,wp.element.createElement("span",{className:"vicon vicon-google"}),wp.element.createElement("span",null,wp.element.createElement("a",{href:n.value.conferenceData.entryPoints[0].uri,target:"_blank"},n.value.conferenceData.entryPoints[0].label)))):"")};function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,l=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw l}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var S=wp.element,N=S.useState,A=S.useEffect,M=S.Fragment,T=wp.data,x=(T.select,T.dispatch,function(e){var t=j(N({}),2),n=t[0],a=t[1],r=j(N([]),2),l=r[0],i=(r[1],j(N(!1),2));i[0],i[1];A(function(){a(e.event)},[e.event]);var o=function(e){if(n&&n.meta&&Array.isArray(n.meta)){var t=n.meta.findIndex(function(t){return t.meta_key==e});return t>-1?n.meta[t].meta_value:""}return""};return wp.element.createElement(M,null,n.hasOwnProperty("id")?wp.element.createElement("div",{className:"event_wrapper"},wp.element.createElement("span",{onClick:function(){e.close()}}),wp.element.createElement("div",{className:"event"},wp.element.createElement("div",{className:"event_details"},wp.element.createElement("h2",{dangerouslySetInnerHTML:{__html:n.post_title}}),n.description?wp.element.createElement("div",{className:"event_description",dangerouslySetInnerHTML:{__html:n.description}}):"",n.meta?wp.element.createElement("div",{className:"event_start_end"},wp.element.createElement("span",null,wp.element.createElement("strong",null,window.vibecalwidget.translations.starts),wp.element.createElement("span",null,wp.element.createElement("span",{className:"vicon vicon-calendar"}),wp.element.createElement("span",null,new Date(o("start")).toLocaleString()))),wp.element.createElement("span",null,wp.element.createElement("strong",null,window.vibecalwidget.translations.ends),wp.element.createElement("span",null,wp.element.createElement("span",{className:"vicon vicon-calendar"}),wp.element.createElement("span",null,new Date(o("end")).toLocaleString()))),wp.element.createElement(P,{event:n})):""),e.event?wp.element.createElement(M,null,e.edit?wp.element.createElement("div",{className:"event_participants"},wp.element.createElement("label",null,window.vibecalwidget.translations.participants,":"),wp.element.createElement("div",{className:"all"},l&&l.length?l.map(function(e){return wp.element.createElement("span",{class:"event_participant",className:"tip",title:e.nickname},wp.element.createElement("img",{src:e.image}))}):"")):"",wp.element.createElement("div",{className:"event_actions"},wp.element.createElement("a",{className:"link",href:n.link},window.vibecalwidget.translations.see_details),wp.element.createElement("a",{className:"link",onClick:function(){e.close()}},window.vibecalwidget.translations.cancel))):"")):"")});function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],a=!0,r=!1,l=void 0;try{for(var i,o=e[Symbol.iterator]();!(a=(i=o.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw l}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var L=wp.element,F=(L.createElement,L.useState),R=L.useEffect,G=L.Fragment,V=L.render,B=wp.data,J=B.dispatch,q=(B.select,function(e){var t=C(F([]),2),n=t[0],r=t[1],l=C(F([]),2),i=(l[0],l[1],C(F({}),2)),o=(i[0],i[1],C(F({label:"",start:(new Date).getTime(),end:(new Date).setDate((new Date).getDate()+7)}),2)),s=o[0],c=o[1],u=C(F(!1),2),m=u[0],d=u[1];R(function(){w([],"update_events"),s.start&&s.end&&fetch("".concat(window.vibecalwidget.api_url,"/event/getPublicEvents?client_id=").concat(window.vibecalwidget.client_id),{method:"post",body:JSON.stringify({filter:s})}).then(function(e){return e.json()}).then(function(e){e.status?w(e.data,"update_events"):e.hasOwnProperty("message")&&J("vibebp").addNotification({text:e.message})})},[s]);var w=function e(t,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3];var l=W(n),i=-1;switch(a){case"update":(i=l.findIndex(function(e){return e.id==t.id}))>=0&&(l[i]=t,e(l,"update_events"));break;case"update_events":"list"!=window.vibecalwidget.settings.show_events&&"grid"!=window.vibecalwidget.settings.show_events||(t=p(t)),Array.isArray(t)&&t.length&&(window.events=W(t)),r(t),window.vibecalwidget.calevents=W(t);break;case"show_event_id":d(window.events[window.events.findIndex(function(e){return e.id==t})])}},p=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=[];return e.map(function(e){var n={};if(e.id&&(n.id=e.id),e.post_title&&(n.title=e.post_title),e.hasOwnProperty("meta")&&Array.isArray(e.meta)&&e.meta.length){var a=e.meta.findIndex(function(e){return"recurring"==e.meta_key});a>-1&&e.meta[a].meta_value?(n.groupId=n.id,"daysOfWeek"==e.meta[a].meta_value.recurring&&(n.daysOfWeek=e.meta[a].meta_value.daysOfWeek),e.meta.map(function(t){if(t.meta_key&&t.meta_value)if("start"==t.meta_key){n.startTime=new Date(t.meta_value).getHours()+":"+new Date(t.meta_value).getMinutes(),n.startRecur=new Date(t.meta_value);var r=new Date;if("list"==window.vibecalwidget.settings.show_events||"grid"==window.vibecalwidget.settings.show_events){if("daysOfWeek"==e.meta[a].meta_value){var l=e.meta[e.meta.findIndex(function(e){return"daysOfWeek"==e.meta_key})].meta_value,i=0;l.map(function(e){e>r.getDay()&&!i&&(i=r.getDay)}),i||(i=l[0]+7),r.setDate((new Date).getDate()+i-r.getDay())}else(new Date).getHours()>new Date(t.meta_value).getHours()&&r.setDate((new Date).getDate()+1);r.setHours(new Date(t.meta_value).getHours(),new Date(t.meta_value).getMinutes()),n.start=r.getTime()}}else if("end"==t.meta_key){n.endTime=new Date(t.meta_value).getHours()+":"+new Date(t.meta_value).getMinutes(),n.endRecur=new Date(t.meta_value);var o=new Date;if("list"==window.vibecalwidget.settings.show_events||"grid"==window.vibecalwidget.settings.show_events){if("daysOfWeek"==e.meta[a].meta_value){var s=e.meta[e.meta.findIndex(function(e){return"daysOfWeek"==e.meta_key})].meta_value,c=0;s.map(function(e){e>o.getDay()&&!c&&(c=o.getDay)}),c||(c=s[0]+7),o.setDate((new Date).getDate()+c-o.getDay())}else(new Date).getHours()>new Date(t.meta_value).getHours()&&o.setDate((new Date).getDate()+1);o.setHours(new Date(t.meta_value).getHours(),new Date(t.meta_value).getMinutes()),n.end=o.getTime()}}else"color"==t.meta_key?n.color=t.meta_value:n[t.meta_key]=t.meta_value})):e.meta.map(function(e){e.meta_key&&e.meta_value&&("start"==e.meta_key?n.start=e.meta_value:"end"==e.meta_key?n.end=e.meta_value:"color"==e.meta_key&&(n.color=e.meta_value))})}n.link=e.link,n.description=e.description,t.push(n)}),t},v=function(e){return("0"+e).slice(-2)};return wp.element.createElement(G,null,"list"==window.vibecalwidget.settings.show_events?wp.element.createElement("div",{className:"vibe_cal_events "+window.vibecalwidget.settings.show_events},n.map(function(e){return wp.element.createElement("div",{className:"vibe_cal_event"},wp.element.createElement("span",{className:"cal_date"},wp.element.createElement("span",null,wp.element.createElement("span",null,v(new Date(e.start).getDate())),wp.element.createElement("span",null,window.vibecalwidget.months[new Date(e.start).getMonth()])),new Date(e.end).getDate()!=new Date(e.start).getDate()?wp.element.createElement("span",null,wp.element.createElement("span",null,v(new Date(e.end).getDate())),wp.element.createElement("span",null,window.vibecalwidget.months[new Date(e.end).getMonth()])):""),wp.element.createElement("span",{className:"cal_time"},wp.element.createElement("span",null,v(new Date(e.start).getHours()),":",v(new Date(e.start).getMinutes())),wp.element.createElement("span",null,v(new Date(e.end).getHours()),":",v(new Date(e.end).getMinutes()))),wp.element.createElement("div",{className:"event_details"},wp.element.createElement("a",{href:e.link,dangerouslySetInnerHTML:{__html:e.title}})))})):"grid"==window.vibecalwidget.settings.show_events?wp.element.createElement("div",{className:"vibe_cal_events "+window.vibecalwidget.settings.show_events},n.map(function(e){if(e.hasOwnProperty("start"))return wp.element.createElement("div",{className:"vibe_cal_event cal_grid"},wp.element.createElement("span",{className:"cal_date"},wp.element.createElement("span",null,wp.element.createElement("span",null,v(new Date(e.start).getDate())),wp.element.createElement("span",null,window.vibecalwidget.months[new Date(e.start).getMonth()])),new Date(e.end).getDate()!=new Date(e.start).getDate()?wp.element.createElement("span",null,wp.element.createElement("span",null,v(new Date(e.end).getDate())),wp.element.createElement("span",null,window.vibecalwidget.months[new Date(e.end).getMonth()])):""),wp.element.createElement("div",{className:"event_details"},wp.element.createElement("a",{href:e.link,dangerouslySetInnerHTML:{__html:e.title}}),wp.element.createElement("span",null,wp.element.createElement("span",null,v(new Date(e.start).getHours()),":",v(new Date(e.start).getMinutes())),wp.element.createElement("span",null,v(new Date(e.end).getHours()),":",v(new Date(e.end).getMinutes()))),wp.element.createElement("p",{dangerouslySetInnerHTML:{__html:e.description}})))})):wp.element.createElement(a.Provider,{value:{events:n,update:w}},wp.element.createElement("div",{className:m?"vibe_calendar show_event":"vibe_calendar"},wp.element.createElement(y,{updateFilter:function(e,t){c(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach(function(t){H(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},s,{start:e,end:t}))}}),m?wp.element.createElement(x,{event:m,close:function(){d(!1)},update:function(e){d(!1),setNewEvent(e)}}):"")))});document.addEventListener("DOMContentLoaded",function(){V(wp.element.createElement(q,null),document.getElementById("vibe_cal_widget"))}),document.addEventListener("vibebpvibe_cal_widget_loaded",function(){V(wp.element.createElement(q,null),document.getElementById("vibe_cal_widget"))})}]);